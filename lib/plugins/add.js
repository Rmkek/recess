// Generated by CoffeeScript 2.1.1
var fs, globby, ignore, path;

path = require('path');

fs = require('fs-extra');

globby = require('globby');

ignore = require('ignore');

module.exports = function(recess) {
  var plugin, reporter;
  reporter = recess.reporter;
  plugin = {};
  plugin.pipes = {
    add: (settings) => {
      if (!Array.isArray(settings)) {
        settings = [settings];
      }
      // PIPE #
      return recess.i.any(async function(files, cond) {
        var glb, ig, paths;
        // get paths
        if (settings.length !== 0) {
          ig = ignore().add(recess.ignored);
          glb = globby.sync(settings, {
            cwd: cond.workdir
          });
          paths = ig.filter(glb);
          // no files at input
          if ((paths.length === 0) && (glb.length === paths.length)) {
            reporter.noFiles(settings);
          }
          // load files
          await recess.d.eachAsync(paths, async function(pth) {
            var contents;
            contents = (await fs.readFile(path.resolve(cond.workdir, pth)));
            files.push(new recess.File(pth, contents));
          });
        }
        return files;
      });
    }
  };
  plugin.pipes.load = plugin.pipes.add;
  return plugin;
};

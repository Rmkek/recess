// Generated by CoffeeScript 2.0.2
var fs, globby, ignore, path;

path = require('path');

fs = require('fs-extra');

globby = require('globby');

ignore = require('ignore');

module.exports = function(punk) {
  var plugin, reporter;
  reporter = punk.reporter;
  plugin = {};
  plugin.pipes = {
    add: function(settings) {
      if (!Array.isArray(settings)) {
        settings = [settings];
      }
      // PIPE #
      return async function(files, cond) {
        var glb, ig, paths;
        // get paths
        if (settings.length !== 0) {
          ig = ignore().add(punk.ignored);
          glb = globby.sync(settings, {
            cwd: cond.workdir
          });
          paths = ig.filter(glb);
          // no files at input
          if ((paths.length === 0) && (glb.length === paths.length)) {
            reporter.noFiles(settings);
          }
          // load files
          await punk.d.eachAsync(paths, async function(pth) {
            var contents;
            contents = (await fs.readFile(path.resolve(cond.workdir, pth)));
            files.push(new punk.File(pth, contents));
          });
        } else {
          files = [];
        }
        return files;
      };
    }
  };
  plugin.pipes.load = plugin.pipes.add;
  return plugin;
};
